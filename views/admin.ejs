<!DOCTYPE html>
<html>
<head>
    <title>Categories</title>
    <%- include('headerfiles') %>

    <style>
        .error{
            color: red;
        }
        #admin_body{
            background-color: #2c3034;
        }
    </style>

    <script>
        function insertAdminValues() {
            $('#adminform').validate();
            if ($('#adminform').valid()) {
                let formcontrols = document.getElementById("adminform").elements;
                let formdata = new FormData();
                for (let i = 0; i < formcontrols.length; i++) {
                    if (formcontrols[i].type !== "button") {
                        formdata.append(formcontrols[i].name, formcontrols[i].value);
                    }
                }

                let httpreq = new XMLHttpRequest();
                httpreq.onreadystatechange = function () {
                    if (this.readyState === 4 && this.status === 200) {
                        let CheckResponse = document.getElementById("response");
                        if(this.response === "exist"){
                            CheckResponse.className = `alert alert-danger`;
                            CheckResponse.innerText = `Username already exist.`;
                        }else{
                            getAdminData();
                            CheckResponse.className = `alert alert-success`;
                            CheckResponse.innerText = `Username added successfully`;
                            document.getElementById("adminform").reset();

                        }

                    }
                }
                httpreq.open('post', "/admin/insert-admin-data", true);
                httpreq.send(formdata);
            }
        }

        function getAdminData() {
            var http = new XMLHttpRequest();
            http.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    console.log(JSON.parse(this.response));
                    var data = JSON.parse(this.response);

                    var tableTag = `<table class="table table-dark table-hover">`;
                    tableTag += `<thead><tr><th>Id No</th><th>Username</th>
                                 <th>E-Mail</th>
                                 <th>Phone-No</th>
                                 <th>Password</th>
                                 <th>Delete</th>
                                  </tr></thead>`;


                    tableTag += `<tbody>`;
                    data.forEach(function (value, index) {
                        tableTag += `<tr>`;
                        tableTag += `<td>${index+1}</td>`;
                        tableTag += `<td>${value.username}</td>`;
                        tableTag += `<td>${value.email}</td>`;
                        tableTag += `<td>${value.pno}</td>`;
                        tableTag += `<td>${value.password}</td>`;

                        tableTag += `<td>`;

                        tableTag += `<button onclick="deleteAdmin('${value.username}')" type="button" class="btn btn-danger btn-sm">
                         <i class="fa fa-trash-alt"></i> DELETE</button>`;

                        tableTag += `</td>`;

                        tableTag += `</tr>`;
                    });
                    tableTag += `</tbody></table>`;


                    document.getElementById("AdminTableBody").innerHTML = tableTag;
                }
            }
            http.open("get", "/admin/get-admin-data", true);
            http.send();
        }

        function deleteAdmin(username) {
            var http = new XMLHttpRequest();
            http.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    alert(this.response);
                    getAdminData();
                }
            }
            http.open("get", `/admin/delete?username=${username}`, true);
            http.send();
        }

    </script>


</head>

<body onload="getAdminData()" id="admin_body">
<%- include('headerfilesadmin')%>
<div class="container">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <h1 class="text-center mt-3 mb-5 display-5 text-light border-bottom">Manage Admin</h1>

            <button type="button" data-bs-toggle="modal" data-bs-target="#AdminModal" class="btn btn-success mb-3" >
                <i class="fa fa-plus" ></i>  Add New Admin
            </button>

            <div class="modal fade" id="AdminModal">
                <div class="modal-dialog">

                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Add New Admin</h5>
                            <button type="button" class="close" data-bs-dismiss="modal" aria-label="close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>

                        <div class="modal-body">

                            <form id="adminform">
                                <div class="form-group mb-3">
<!--                                    <label for="">Enter Username</label>-->
                                    <input type="text" name="username" id="username"
                                           class="form-control" data-rule-required="true"
                                           placeholder="Enter Username"
                                           data-msg-required="*Username Required"/>
                                </div>
                                <div class="form-group mb-3">
<!--                                    <label for="">Enter E-Mail</label>-->
                                    <input type="email" name="email" id="email" class="form-control"
                                           data-rule-required="true"
                                           placeholder="Enter E-Mail"
                                           data-msg-required="*Required Email"/>
                                </div>

                                <div class="form-group mb-3">
<!--                                    <label for="">Enter Mobile Number</label>-->
                                    <input type="text" name="pno" id="pno" class="form-control"
                                           data-rule-required="true"
                                           maxlength="10"
                                           minlength="10"
                                           data-rule-number="true"
                                           placeholder="Enter Mobile Number"
                                           data-msg-required="*Required MobileNumber"/>
                                </div>

                                <div class="form-group mb-3">
<!--                                    <label for="">Enter Password</label>-->
                                    <input type="password" name="password" id="password"
                                           class="form-control" data-rule-required="true"
                                           placeholder="Enter Password"
                                           data-msg-required="Enter Password"/>
                                </div>


                                <div class="form-group mt-2 mb-3">
                                    <input type="button" id="btnncat" onclick="insertAdminValues()" value="SUBMIT"
                                           class="btn btn-primary"/>
                                </div>
                            </form>
                            <div id="response"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="AdminTableBody"></div>


        </div>
    </div>
</div>

</body>